<html><head><meta charset="utf-8"><title>Pretty Diff</title><style>body {text-align: center;}#wrapper {display: inline-block;margin-top: 1em;min-width: 800px;text-align: left;}h2 {background: #fafafa;background: -moz-linear-gradient(#fafafa, #eaeaea);background: -webkit-linear-gradient(#fafafa, #eaeaea);-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr='#fafafa',endColorstr='#eaeaea')";border: 1px solid #d8d8d8;border-bottom: 0;color: #555;font: 14px sans-serif;overflow: hidden;padding: 10px 6px;text-shadow: 0 1px 0 white;margin: 0;}.file-diff {border: 1px solid #d8d8d8;margin-bottom: 1em;overflow: auto;padding: 0.5em 0;}.file-diff > div {width: 100%:}pre {margin: 0;font-family: "Bitstream Vera Sans Mono", Courier, monospace;font-size: 12px;line-height: 1.4em;text-indent: 0.5em;}.file {color: #aaa;}.delete {background-color: #fdd;}.insert {background-color: #dfd;}.info {color: #a0b;}</style></head><body><div id="wrapper"><h2>badcat.c</h2><div class="file-diff"><pre class="file">diff --git a/badcat.c b/middlingbad.c</pre><pre class="context">index 55d8ef4..b1eeb0e 100644</pre><pre class="delete">--- a/badcat.c</pre><pre class="insert">+++ b/middlingbad.c</pre><pre class="info">@@ -1,29 +1,66 @@</pre><pre class="context"> #include &lt;stdio.h&gt;</pre><pre class="context"> #include &lt;stdlib.h&gt; // For exit()</pre><pre class="delete">-#include &lt;string.h&gt; </pre><pre class="insert">+#include &lt;string.h&gt; // for strncpy</pre><pre class="insert">+#include &lt;limits.h&gt; // for PATH_MAX</pre><pre class="insert">+</pre><pre class="insert">+///&lt; A program to print a file - like our own version of 'cat'</pre><pre class="insert">+///&lt; It's good to include some comment at leat</pre><pre class="insert">+//</pre><pre class="context"> </pre><pre class="context"> int main(int argc,char*argv[])</pre><pre class="context"> {</pre><pre class="context"> 	FILE *fptr;</pre><pre class="delete">-	char filename[100], c;</pre><pre class="insert">+	char filename[PATH_MAX]; // 100 isn't a good value - long enough to pass tests, short enough to fail easily</pre><pre class="insert">+			// PATH_MAX exists for reasons and is fairly portable</pre><pre class="insert">+	char c; // mixed declarations on one line are bad news - easily cause bugs</pre><pre class="context"> </pre><pre class="delete">-	if (argc==2) strcpy(filename,argv[1]);</pre><pre class="delete">-	else {</pre><pre class="insert">+	if (argc==2) {</pre><pre class="insert">+		strncpy(filename,argv[1],PATH_MAX); // strncpy is safer than strcpy</pre><pre class="insert">+		if (filename[0]=='\0') { // check odd cases</pre><pre class="insert">+			fprintf(stderr,"Error reading name (2)\n"); // using an errno like method would be better </pre><pre class="insert">+			exit(2);</pre><pre class="insert">+		}</pre><pre class="insert">+	} else if (argc==1) {</pre><pre class="context"> 		printf("Enter the filename to open \n");</pre><pre class="delete">-		scanf("%s", filename);</pre><pre class="delete">-	}</pre><pre class="insert">+		// scanf("%s", filename); - scanf can't really be safe</pre><pre class="insert">+		// ok the code below is fairly OTT, but hey prompting is dangerous!!! </pre><pre class="insert">+		char *rv=fgets(filename,PATH_MAX,stdin); // use fgets and check results</pre><pre class="insert">+		if (rv==NULL || filename[0]=='\0') {</pre><pre class="insert">+			fprintf(stderr,"Error reading name (3)\n");</pre><pre class="insert">+			exit(3);</pre><pre class="insert">+		}</pre><pre class="insert">+		// strip CR/LF from end of string</pre><pre class="insert">+		size_t flen=strlen(filename);</pre><pre class="insert">+		if (flen==0) {</pre><pre class="insert">+			fprintf(stderr,"Error reading name (4)\n");</pre><pre class="insert">+			exit(5);</pre><pre class="insert">+		}</pre><pre class="insert">+		// strip CR/LF from end of string</pre><pre class="insert">+		while (flen &amp;&amp; (filename[flen-1]=='\n' || filename[flen-1]=='\r')) {</pre><pre class="insert">+			filename[flen-1]='\0';</pre><pre class="insert">+			flen--;</pre><pre class="insert">+		}</pre><pre class="insert">+		if (flen==0) {</pre><pre class="insert">+			fprintf(stderr,"Error reading name (5)\n");</pre><pre class="insert">+			exit(5);</pre><pre class="insert">+		}</pre><pre class="insert">+</pre><pre class="insert">+	} </pre><pre class="context"> </pre><pre class="context"> 	// Open file</pre><pre class="context"> 	fptr = fopen(filename, "r");</pre><pre class="delete">-	if (fptr = NULL) {</pre><pre class="delete">-		printf("Cannot open file \n");</pre><pre class="delete">-		exit(0);</pre><pre class="insert">+	if (fptr == NULL) { // the "==" vs. "=" here means not crashing every time</pre><pre class="insert">+		printf("Cannot open file \n"); </pre><pre class="insert">+		exit(5); // don't return zero - that's used for 'success' by convention</pre><pre class="context"> 	}</pre><pre class="context"> </pre><pre class="context"> 	// Read contents from file</pre><pre class="delete">-	c = fgetc(fptr);</pre><pre class="insert">+	c = (char) fgetc(fptr);</pre><pre class="context"> 	while (c != EOF) {</pre><pre class="delete">-		printf ("%c", c);</pre><pre class="insert">+		printf ("%c", c); </pre><pre class="context"> 		c = fgetc(fptr);</pre><pre class="context"> 	}</pre><pre class="insert">+</pre><pre class="insert">+	fclose(fptr); // close the file</pre><pre class="insert">+	return 0; // return success if that's what happened</pre><pre class="context"> }</pre></div></div></body></html>
